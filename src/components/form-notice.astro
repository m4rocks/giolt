---
interface Props {
	// biome-ignore lint: Action needs to be any
	action: any;
	successMessage: string;
	errorMessage: string;
}

const result = Astro.getActionResult(Astro.props.action);
---

{result ?
	<data
		id="form-result"
		data-type={(result && !result.error) ? "success" : "error"}
		data-message={(result && !result.error) ? Astro.props.successMessage : Astro.props.errorMessage}
	/>
: null}

<script>
	import { toast } from "sonner";

	const fn = () => {
		const result = document.getElementById("form-result");

		if (result) {
			const type = result.getAttribute("data-type");
			const message = result.getAttribute("data-message");

			if (type === "success") {
				toast.success(message);
			} else if (type === "error") {
				toast.error(message);
			}
		}

		if (!document.getElementsByTagName("form")[0]) return;
		document.getElementsByTagName("form")[0].addEventListener("submit", () => {
			const id = toast.loading("Loading...");

			document.addEventListener("astro:before-swap", () => {
				toast.dismiss(id)
			})
		});
	}


	document.addEventListener("astro:page-load", fn);
</script>
