---
import { organizations } from "@/db/schema";
import Layout from "@/layouts/dashboard-layout.astro";
import { protectRoute } from "@/lib/clerk";
import { OrganizationProfile } from "@clerk/astro/components";
import { eq } from "drizzle-orm";

const res = await protectRoute(Astro);
if (res) return res;

const { orgId } = Astro.locals.auth();
const db = Astro.locals.db;

const org = await db
	.select()
	.from(organizations)
	.where(eq(organizations.id, orgId as string))
	.get();

if (!org) {
	return Astro.redirect("/select");
}
---

<Layout
	title={org.name}
	class="flex flex-col"
>
	<OrganizationProfile
		afterLeaveOrganizationUrl="/select"
		routing="path"
		path="/dashboard/general"
	/>
</Layout>

<style is:global>
	.cl-organizationProfile-root {
		flex: 1;
		width: 100%;
		height: 100%;
	}

	.cl-organizationProfile-root > .cl-cardBox {
		width: 100%;
		height: 100%;
		max-width: none;
		box-shadow: none;
		display: flex;
		border: none;
	}
	.cl-organizationProfile-root .cl-pageScrollBox {
		padding: 0;
	}

	.cl-organizationProfile-root .cl-scrollBox {
		width: 100%;
		height: calc(100vh - 4rem - 2rem);
	}

	.cl-organizationProfile-root .cl-navbar,
	.cl-organizationProfile-root .cl-navbarMobileMenuRow {
		display: none;
	}
</style>
